!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((r="undefined"!=typeof globalThis?globalThis:r||self).serialize64={})}(this,(function(r){"use strict";const t="function"==typeof atob,e="function"==typeof btoa,n="function"==typeof Buffer,a=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder&&new TextEncoder,[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="]),i=(r=>{let t={};return r.forEach(((r,e)=>t[r]=e)),t})(a),o=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,f=String.fromCharCode.bind(String),c="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):(r,t=(r=>r))=>new Uint8Array(Array.prototype.slice.call(r,0).map(t)),l=r=>r.replace(/[+\/]/g,(r=>"+"==r?"-":"_")).replace(/=+$/m,""),u=r=>r.replace(/[^A-Za-z0-9\+\/]/g,""),y=r=>{let t,e,n,i,o="";const f=r.length%3;for(let f=0;f<r.length;){if((e=r.charCodeAt(f++))>255||(n=r.charCodeAt(f++))>255||(i=r.charCodeAt(f++))>255)throw new TypeError("invalid character found");t=e<<16|n<<8|i,o+=a[t>>18&63]+a[t>>12&63]+a[t>>6&63]+a[63&t]}return f?o.slice(0,f-3)+"===".substring(f):o},s=e?r=>btoa(r):n?r=>Buffer.from(r,"binary").toString("base64"):y,_=n?r=>Buffer.from(r).toString("base64"):r=>{let t=[];for(let e=0,n=r.length;e<n;e+=4096)t.push(f.apply(null,r.subarray(e,e+4096)));return s(t.join(""))},A=(r,t=!1)=>t?l(_(r)):_(r),d=r=>{if(r=r.replace(/\s+/g,""),!o.test(r))throw new TypeError("malformed base64.");r+="==".slice(2-(3&r.length));let t,e,n,a="";for(let o=0;o<r.length;)t=i[r.charAt(o++)]<<18|i[r.charAt(o++)]<<12|(e=i[r.charAt(o++)])<<6|(n=i[r.charAt(o++)]),a+=64===e?f(t>>16&255):64===n?f(t>>16&255,t>>8&255):f(t>>16&255,t>>8&255,255&t);return a},p=t?r=>atob(u(r)):n?r=>Buffer.from(r,"base64").toString("binary"):d,g=n?r=>c(Buffer.from(r,"base64")):r=>c(p(r),(r=>r.charCodeAt(0))),h=r=>g(b(r)),b=r=>u(r.replace(/[-_]/g,(r=>"-"==r?"+":"/"))),E=A,m=h,I={PREFIX:"_S64_",SEPARATOR:":"},R={Int8Array:"___i8",Uint8Array:"__ui8",Int16Array:"__i16",Uint16Array:"_ui16",Int32Array:"__i32",Uint32Array:"_ui32",BigInt64Array:"__i64",BigUint64Array:"_ui64",Float32Array:"__f32",Float64Array:"__f64",ArrayBuffer:"___ab"};let T={___i8:Int8Array,__ui8:Uint8Array,__i16:Int16Array,_ui16:Uint16Array,__i32:Int32Array,_ui32:Uint32Array,__i64:BigInt64Array,_ui64:BigUint64Array,__f32:Float32Array,__f64:Float64Array,___ab:ArrayBuffer};I.PREFIX_LENGTH=I.PREFIX.length+I.SEPARATOR.length+Object.values(R)[0].length;class U{static encode(r){if(!(r.constructor.name in R))return r;let t=null;t=r.constructor.name===ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer);const e=E(t);return`${I.PREFIX}${R[r.constructor.name]}${I.SEPARATOR}${e}`}static decode(r){if("string"!=typeof r)return r;if(!r.startsWith(I.PREFIX))return r;const t=r.slice(0,I.PREFIX_LENGTH),e=r.slice(I.PREFIX_LENGTH),n=m(e);return new(0,T[t.slice(I.PREFIX.length,t.length-1)])(n.buffer)}}r.Codec=U,r.JSON64=class{static parse(r,t){return JSON.parse(r,((r,e)=>{let n=U.decode(e);return"function"==typeof t&&(n=t(r,n)),n}))}static stringify(r,t=null,e=null){return JSON.stringify(r,((r,e)=>{let n=e;return"function"==typeof t&&(n=t(r,e)),U.encode(n)}),e)}},Object.defineProperty(r,"__esModule",{value:!0})}));
